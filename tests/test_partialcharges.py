import numpy as np

from veloxchem.molecule import Molecule


class TestPartialCharges:

    def test_partial_charges(self):

        xyzstr = """21
        xyz
        O             -2.94267        -0.66700        -0.99123
        C             -2.59052        -1.80018        -0.56501
        C             -3.47696        -2.97712        -0.79084
        O             -1.43526        -1.95304         0.21232
        C             -0.39619        -1.01428         0.31735
        C             -0.05669        -0.18991        -0.77366
        C              0.98591         0.73108        -0.67116
        C              1.71057         0.83588         0.51363
        C              1.40144         0.01415         1.59842
        C              0.35227        -0.92344         1.51719
        C              0.05199        -1.78232         2.69357
        O              0.75352        -1.69446         3.73790
        O             -1.00186        -2.69177         2.66739
        H             -4.24873        -3.01688         0.00560
        H             -2.87794        -3.91141        -0.76511
        H             -3.97406        -2.89731        -1.78066
        H             -0.57720        -0.27758        -1.71754
        H              1.23842         1.35866        -1.51618
        H              2.52012         1.55038         0.58990
        H              1.98723         0.11438         2.50365
        H             -1.20631        -3.27593         3.46941
        """

        mol = Molecule.read_xyz_string(xyzstr)

        partial_charges = mol.get_partial_charges(mol.get_charge())
        partial_charges = np.array(partial_charges)

        ref_partial_charges = np.array([
            -0.3761236019355687, 0.23681872357246778, -0.1567977805611376,
            -0.2638855731384204, 0.12146276256783792, -0.0599068508370189,
            -0.09263685437045355, -0.09140703652144179, -0.07444157468451454,
            0.03497010976274914, 0.29110769532281466, -0.37702828457599413,
            -0.3949810787203202, 0.12713534647937028, 0.12281494297785034,
            0.12524394151108745, 0.1513191993536852, 0.12875101859760732,
            0.12878564398526568, 0.15104386920750895, 0.2677553820066251
        ])

        assert np.max(np.abs(partial_charges - ref_partial_charges)) < 1.0e-6
